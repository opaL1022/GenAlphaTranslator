{"version":3,"file":"content.js","mappings":";;;;;;;;;;;;;;;;UAAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;;;;ACtBa;AACb,aAAa,mBAAO,CAAC,2DAA2B;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD;AACvD;AACA;AACA;AACA;AACA;AACA,gCAAgC;AAChC,KAAK;AACL;AACA;AACA;AACA,qCAAqC;AACrC;AACA,CAAC;AACD;AACA;AACA,yCAAyC;AACzC;AACA,uBAAuB,mBAAmB;AAC1C;AACA;AACA;AACA,uBAAuB,mBAAmB;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,mBAAmB,GAAG;AAC7C;AACA;AACA,CAAC;AACD;AACA;AACA;AACA,+CAA+C;AAC/C;AACA;AACA;AACA,oCAAoC;AACpC;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE,IAAI;AACrE,oCAAoC,kBAAkB;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qEAAqE;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD;AACrD;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,sCAAsC;AACtC;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA","sources":["webpack://genalphatranslator/webpack/bootstrap","webpack://genalphatranslator/./src/content.ts"],"sourcesContent":["// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\"use strict\";\nconst dict = require('../public/dictionary.json');\nif (!dict) {\n    console.log(\"dictionary.json is empty\");\n}\nconsole.log(dict);\nconsole.log('Content script loaded!');\nlet density = 0;\nconst originalTexts = new Map();\nfunction savePageSnapshot(root) {\n    const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT);\n    let node;\n    while ((node = walker.nextNode())) {\n        originalTexts.set(node, node.nodeValue || \"\"); // 保存每個文本節點的原始值\n    }\n    console.log(\"Original text snapshot saved.\");\n}\nfunction restoreFromSnapshot() {\n    originalTexts.forEach((value, node) => {\n        node.nodeValue = value; // 恢復文本\n    });\n    console.log(\"All texts restored from snapshot.\");\n}\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n    savePageSnapshot(document.body); // 保存頁面快照\n    console.log(\"Original text snapshot saved.\");\n});\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n    if (message.action === \"enable\") {\n        savePageSnapshot(document.body); //想辦法一開始就存\n        enableFeature();\n        sendResponse({ status: \"success\" });\n    }\n    else if (message.action === \"disable\") {\n        disableFeature();\n        sendResponse({ status: \"success\" });\n    }\n    else if (message.sliderValue !== undefined) {\n        console.log(\"Received slider value:\", message.sliderValue);\n        density = message.sliderValue;\n        restoreFromSnapshot();\n        enableFeature();\n        sendResponse({ status: \"success\" }); // 回應消息\n        return true;\n    }\n});\nfunction clearModifiedTags() {\n    const modifiedNodes = document.querySelectorAll('[data-modified=\"true\"]');\n    modifiedNodes.forEach((node) => {\n        node.removeAttribute('data-modified'); // 移除標記\n        if (node.nodeType === Node.TEXT_NODE) {\n            const parent = node.parentElement;\n            if (parent) {\n                parent.normalize(); // 將文本節點合併\n            }\n        }\n    });\n    console.log(\"All modified tags have been cleared.\");\n}\nfunction enableFeature() {\n    clearModifiedTags();\n    console.log(\"功能已啟用\");\n    const convertText = (node) => {\n        if (node.nodeType === Node.TEXT_NODE) {\n            const parent = node.parentElement;\n            if (parent && !parent.dataset.modified) {\n                let context = [];\n                if (node.nodeValue) {\n                    let texts = node.nodeValue.split(/(\\s+|[.,!?;(){}[\\]\"':])/).filter(Boolean);\n                    for (let i = 0; i < texts.length; i++) {\n                        let word = texts[i].toLowerCase();\n                        let cap = /^[A-Z]$/.test(texts[i].charAt(0));\n                        if (word in dict) {\n                            let text = dict[word][0];\n                            context.push(cap ? text.charAt(0).toUpperCase() + text.slice(1) : text);\n                        }\n                        else {\n                            const randomNum = Math.floor(Math.random() * 100);\n                            if (randomNum < density) {\n                                const dictRand = Object.values(dict);\n                                const dictLen = dictRand.length;\n                                const dictRandNum = Math.floor(Math.random() * dictLen);\n                                let text = dictRand[dictRandNum][0]; //TODO 記得改\n                                context.push(cap ? text.charAt(0).toUpperCase() + text.slice(1) : text);\n                            }\n                            else {\n                                context.push(texts[i]);\n                            }\n                        }\n                    }\n                }\n                node.nodeValue = context.join('');\n                parent.dataset.modified = 'true';\n            }\n        }\n    };\n    const traverseAndModify = (root) => {\n        const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {\n            acceptNode: (node) => {\n                const parent = node.parentNode;\n                if (parent && ['SCRIPT', 'STYLE', 'TEXTAREA'].includes(parent.tagName)) {\n                    return NodeFilter.FILTER_REJECT; // 跳過不處理\n                }\n                return NodeFilter.FILTER_ACCEPT;\n            },\n        });\n        let node;\n        while ((node = walker.nextNode())) {\n            convertText(node);\n        }\n    };\n    traverseAndModify(document.body); // 執行靜態文本修改\n    const observer = new MutationObserver((mutations) => {\n        mutations.forEach((mutation) => {\n            mutation.addedNodes.forEach((node) => {\n                if (node.nodeType === Node.ELEMENT_NODE) {\n                    traverseAndModify(node);\n                }\n            });\n            if (mutation.type === 'characterData') {\n                convertText(mutation.target);\n            }\n        });\n    });\n    observer.observe(document.body, {\n        childList: true,\n        subtree: true,\n        characterData: true,\n    });\n}\nfunction disableFeature() {\n    console.log(\"功能已禁用\");\n    clearModifiedTags();\n    window.location.reload();\n}\n"],"names":[],"sourceRoot":""}